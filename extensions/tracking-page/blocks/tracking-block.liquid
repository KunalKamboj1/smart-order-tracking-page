{% comment %}
  Smart Order Tracking Block
  This block can be added to any page via the theme editor
{% endcomment %}

<div class="tracking-block" data-app="smart-order-tracking-block" {{ block.shopify_attributes }}>
  <div class="tracking-block-container">
    {% if block.settings.show_title %}
      <div class="tracking-block-header">
        <h2 class="tracking-block-title">{{ block.settings.title | default: 'Track Your Order' }}</h2>
        {% if block.settings.subtitle != blank %}
          <p class="tracking-block-subtitle">{{ block.settings.subtitle }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="tracking-block-form-wrapper">
      <form class="tracking-block-form" id="tracking-block-form-{{ block.id }}">
        <div class="tracking-block-inputs">
          <div class="form-group">
            <label for="order-number-{{ block.id }}" class="form-label">Order Number</label>
            <input 
              type="text" 
              id="order-number-{{ block.id }}" 
              name="order_number" 
              class="form-input" 
              placeholder="{{ block.settings.order_placeholder | default: 'e.g., #1001' }}" 
              required
            >
          </div>

          <div class="form-group">
            <label for="contact-info-{{ block.id }}" class="form-label">{{ block.settings.contact_label | default: 'Email or Phone' }}</label>
            <input 
              type="text" 
              id="contact-info-{{ block.id }}" 
              name="contact_info" 
              class="form-input" 
              placeholder="{{ block.settings.contact_placeholder | default: 'email@example.com or phone' }}" 
              required
            >
          </div>
        </div>

        <button type="submit" class="tracking-block-submit-btn" id="track-btn-{{ block.id }}">
          <span class="btn-text">{{ block.settings.button_text | default: 'Track Order' }}</span>
          <span class="btn-loading" style="display: none;">{{ block.settings.loading_text | default: 'Searching...' }}</span>
        </button>
      </form>
    </div>

    <!-- Results Section -->
    <div class="tracking-block-results" id="tracking-results-{{ block.id }}" style="display: none;">
      <!-- Success State -->
      <div class="tracking-block-success" id="tracking-success-{{ block.id }}" style="display: none;">
        <div class="tracking-info-card">
          <div class="tracking-status">
            <h3>{{ block.settings.success_message | default: 'Your tracking information:' }}</h3>
          </div>
          
          <div class="tracking-details" id="tracking-details-{{ block.id }}">
            <!-- Tracking details will be populated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Not Dispatched State -->
      <div class="tracking-block-not-dispatched" id="tracking-not-dispatched-{{ block.id }}" style="display: none;">
        <div class="not-dispatched-card">
          <div class="not-dispatched-icon">üì¶</div>
          <h3>Order Found</h3>
          <p>{{ block.settings.not_dispatched_message | default: 'Your order has not been dispatched yet. We will notify you once it ships.' }}</p>
          <div class="order-summary" id="order-summary-{{ block.id }}">
            <!-- Order details will be populated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Error State -->
      <div class="tracking-block-error" id="tracking-error-{{ block.id }}" style="display: none;">
        <div class="error-card">
          <div class="error-icon">‚ùå</div>
          <h3>{{ block.settings.error_title | default: 'Order Not Found' }}</h3>
          <p>{{ block.settings.error_message | default: 'We could not find an order with those details. Please check your information and try again.' }}</p>
        </div>
      </div>
    </div>

    <!-- Recommended Products Section -->
    {% if block.settings.show_recommended_products %}
    <div class="recommended-products-block" id="recommended-products-{{ block.id }}" style="display: none;">
      <h3>{{ block.settings.recommended_title | default: 'You might also like' }}</h3>
      <div class="products-grid" id="products-grid-{{ block.id }}">
        <!-- Products will be populated by JavaScript -->
      </div>
    </div>
    {% endif %}
  </div>
</div>

<style>
  .tracking-block {
    margin: {{ block.settings.margin_top }}px 0 {{ block.settings.margin_bottom }}px 0;
    padding: {{ block.settings.padding_top }}px {{ block.settings.padding_horizontal }}px {{ block.settings.padding_bottom }}px {{ block.settings.padding_horizontal }}px;
  }

  .tracking-block-container {
    max-width: {{ block.settings.max_width }}px;
    margin: 0 auto;
    background: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    {% if block.settings.show_border %}
      border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    {% endif %}
    {% if block.settings.show_shadow %}
      box-shadow: 0 {{ block.settings.shadow_blur }}px {{ block.settings.shadow_spread }}px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 }});
    {% endif %}
    padding: {{ block.settings.inner_padding }}px;
  }

  .tracking-block-header {
    text-align: {{ block.settings.text_alignment }};
    margin-bottom: 1.5rem;
  }

  .tracking-block-title {
    font-size: {{ block.settings.title_size }}px;
    font-weight: {{ block.settings.title_weight }};
    color: {{ block.settings.title_color }};
    margin-bottom: 0.5rem;
    line-height: 1.2;
  }

  .tracking-block-subtitle {
    font-size: {{ block.settings.subtitle_size }}px;
    color: {{ block.settings.subtitle_color }};
    line-height: 1.4;
  }

  .tracking-block-inputs {
    {% if block.settings.layout == 'horizontal' %}
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    {% endif %}
    margin-bottom: 1rem;
  }

  .tracking-block .form-group {
    margin-bottom: {% if block.settings.layout == 'horizontal' %}0{% else %}1rem{% endif %};
  }

  .tracking-block .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: {{ block.settings.label_weight }};
    font-size: {{ block.settings.label_size }}px;
    color: {{ block.settings.label_color }};
  }

  .tracking-block .form-input {
    width: 100%;
    padding: {{ block.settings.input_padding }}px;
    border: {{ block.settings.input_border_width }}px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: {{ block.settings.input_font_size }}px;
    background: {{ block.settings.input_background }};
    color: {{ block.settings.input_text_color }};
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .tracking-block .form-input:focus {
    outline: none;
    border-color: {{ block.settings.primary_color }};
    {% if block.settings.show_focus_shadow %}
      box-shadow: 0 0 0 3px {{ block.settings.primary_color | color_modify: 'alpha', 0.1 }};
    {% endif %}
  }

  .tracking-block-submit-btn {
    width: {% if block.settings.button_full_width %}100%{% else %}auto{% endif %};
    padding: {{ block.settings.button_padding_vertical }}px {{ block.settings.button_padding_horizontal }}px;
    background: {{ block.settings.primary_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: {{ block.settings.button_font_size }}px;
    font-weight: {{ block.settings.button_font_weight }};
    cursor: pointer;
    transition: all 0.2s;
    {% if not block.settings.button_full_width %}
      display: block;
      margin: 0 auto;
    {% endif %}
  }

  .tracking-block-submit-btn:hover {
    background: {{ block.settings.primary_color | color_darken: 10 }};
    {% if block.settings.button_hover_transform %}
      transform: translateY(-1px);
    {% endif %}
  }

  .tracking-block-submit-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .tracking-block-results {
    margin-top: 1.5rem;
  }

  .tracking-block .tracking-info-card,
  .tracking-block .not-dispatched-card,
  .tracking-block .error-card {
    padding: 1.5rem;
    border-radius: {{ block.settings.result_border_radius }}px;
    margin-bottom: 1rem;
  }

  .tracking-block .tracking-info-card {
    background: {{ block.settings.success_background }};
    border: 1px solid {{ block.settings.success_border }};
    color: {{ block.settings.success_text }};
  }

  .tracking-block .not-dispatched-card {
    background: {{ block.settings.warning_background }};
    border: 1px solid {{ block.settings.warning_border }};
    color: {{ block.settings.warning_text }};
    text-align: center;
  }

  .tracking-block .error-card {
    background: {{ block.settings.error_background }};
    border: 1px solid {{ block.settings.error_border }};
    color: {{ block.settings.error_text }};
    text-align: center;
  }

  .tracking-block .not-dispatched-icon,
  .tracking-block .error-icon {
    font-size: 2rem;
    margin-bottom: 1rem;
  }

  .tracking-block .tracking-detail {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid {{ block.settings.success_border | color_modify: 'alpha', 0.3 }};
  }

  .tracking-block .tracking-detail:last-child {
    border-bottom: none;
  }

  .tracking-block .tracking-link {
    color: {{ block.settings.primary_color }};
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 1rem;
    background: {{ block.settings.primary_color | color_modify: 'alpha', 0.1 }};
    border-radius: {{ block.settings.input_border_radius }}px;
    transition: all 0.2s;
  }

  .tracking-block .tracking-link:hover {
    background: {{ block.settings.primary_color | color_modify: 'alpha', 0.2 }};
    text-decoration: none;
  }

  .recommended-products-block {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid {{ block.settings.border_color | default: '#e5e7eb' }};
    text-align: center;
  }

  .recommended-products-block h3 {
    font-size: {{ block.settings.recommended_title_size | default: 20 }}px;
    color: {{ block.settings.title_color }};
    margin-bottom: 1rem;
  }

  .tracking-block .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax({{ block.settings.product_card_width | default: 150 }}px, 1fr));
    gap: {{ block.settings.product_gap | default: 16 }}px;
    margin-top: 1rem;
  }

  .tracking-block .product-card {
    border: 1px solid {{ block.settings.border_color | default: '#e5e7eb' }};
    border-radius: {{ block.settings.border_radius }}px;
    padding: 1rem;
    text-align: center;
    transition: transform 0.2s, box-shadow 0.2s;
    background: white;
  }

  .tracking-block .product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .tracking-block-inputs {
      grid-template-columns: 1fr;
    }
    
    .tracking-block .form-group {
      margin-bottom: 1rem;
    }
    
    .tracking-block-container {
      padding: {{ block.settings.inner_padding | divided_by: 2 }}px;
    }
    
    .tracking-block-title {
      font-size: {{ block.settings.title_size | times: 0.8 }}px;
    }
    
    .tracking-block .products-grid {
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }
  }
</style>

{{ 'tracking-block.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Order Tracking Block",
  "target": "section",
  "available_if": "{{ app.metafields.tracking.tracking_block_enabled == 'true' }}",
  "settings": [
    {
      "type": "header",
      "content": "Content Settings"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Show title",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Track Your Order"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle",
      "info": "Optional subtitle text"
    },
    {
      "type": "text",
      "id": "order_placeholder",
      "label": "Order number placeholder",
      "default": "e.g., #1001"
    },
    {
      "type": "text",
      "id": "contact_label",
      "label": "Contact field label",
      "default": "Email or Phone"
    },
    {
      "type": "text",
      "id": "contact_placeholder",
      "label": "Contact field placeholder",
      "default": "email@example.com or phone"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Track Order"
    },
    {
      "type": "text",
      "id": "loading_text",
      "label": "Loading text",
      "default": "Searching..."
    },
    {
      "type": "header",
      "content": "Messages"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success message",
      "default": "Your tracking information:"
    },
    {
      "type": "textarea",
      "id": "not_dispatched_message",
      "label": "Not dispatched message",
      "default": "Your order has not been dispatched yet. We will notify you once it ships."
    },
    {
      "type": "text",
      "id": "error_title",
      "label": "Error title",
      "default": "Order Not Found"
    },
    {
      "type": "textarea",
      "id": "error_message",
      "label": "Error message",
      "default": "We could not find an order with those details. Please check your information and try again."
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Form layout",
      "options": [
        { "value": "vertical", "label": "Vertical" },
        { "value": "horizontal", "label": "Horizontal" }
      ],
      "default": "vertical"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "max_width",
      "label": "Maximum width (px)",
      "min": 300,
      "max": 1200,
      "step": 50,
      "default": 600
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Top margin (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Bottom margin (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "label": "Horizontal padding (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20
    },
    {
      "type": "range",
      "id": "inner_padding",
      "label": "Inner padding (px)",
      "min": 10,
      "max": 60,
      "step": 5,
      "default": 30
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "label_color",
      "label": "Label color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "input_text_color",
      "label": "Input text color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "input_background",
      "label": "Input background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Input border color",
      "default": "#e1e5e9"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Title font size (px)",
      "min": 16,
      "max": 48,
      "step": 2,
      "default": 28
    },
    {
      "type": "select",
      "id": "title_weight",
      "label": "Title font weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "label": "Subtitle font size (px)",
      "min": 12,
      "max": 24,
      "step": 1,
      "default": 16
    },
    {
      "type": "range",
      "id": "label_size",
      "label": "Label font size (px)",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 14
    },
    {
      "type": "select",
      "id": "label_weight",
      "label": "Label font weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" }
      ],
      "default": "500"
    },
    {
      "type": "range",
      "id": "input_font_size",
      "label": "Input font size (px)",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 16
    },
    {
      "type": "range",
      "id": "button_font_size",
      "label": "Button font size (px)",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 16
    },
    {
      "type": "select",
      "id": "button_font_weight",
      "label": "Button font weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" }
      ],
      "default": "500"
    },
    {
      "type": "header",
      "content": "Form Styling"
    },
    {
      "type": "range",
      "id": "input_padding",
      "label": "Input padding (px)",
      "min": 8,
      "max": 20,
      "step": 2,
      "default": 12
    },
    {
      "type": "range",
      "id": "input_border_width",
      "label": "Input border width (px)",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "label": "Input border radius (px)",
      "min": 0,
      "max": 20,
      "step": 2,
      "default": 6
    },
    {
      "type": "checkbox",
      "id": "show_focus_shadow",
      "label": "Show focus shadow on inputs",
      "default": true
    },
    {
      "type": "header",
      "content": "Button Styling"
    },
    {
      "type": "checkbox",
      "id": "button_full_width",
      "label": "Full width button",
      "default": true
    },
    {
      "type": "range",
      "id": "button_padding_vertical",
      "label": "Button vertical padding (px)",
      "min": 8,
      "max": 20,
      "step": 2,
      "default": 14
    },
    {
      "type": "range",
      "id": "button_padding_horizontal",
      "label": "Button horizontal padding (px)",
      "min": 16,
      "max": 40,
      "step": 4,
      "default": 24
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "label": "Button border radius (px)",
      "min": 0,
      "max": 20,
      "step": 2,
      "default": 6
    },
    {
      "type": "checkbox",
      "id": "button_hover_transform",
      "label": "Button hover animation",
      "default": true
    },
    {
      "type": "header",
      "content": "Border & Shadow"
    },
    {
      "type": "checkbox",
      "id": "show_border",
      "label": "Show border",
      "default": false
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border width (px)",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 1
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#e5e7eb"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Container border radius (px)",
      "min": 0,
      "max": 20,
      "step": 2,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_shadow",
      "label": "Show shadow",
      "default": true
    },
    {
      "type": "range",
      "id": "shadow_blur",
      "label": "Shadow blur (px)",
      "min": 2,
      "max": 20,
      "step": 2,
      "default": 10
    },
    {
      "type": "range",
      "id": "shadow_spread",
      "label": "Shadow spread (px)",
      "min": 0,
      "max": 10,
      "step": 1,
      "default": 0
    },
    {
      "type": "range",
      "id": "shadow_opacity",
      "label": "Shadow opacity (%)",
      "min": 5,
      "max": 50,
      "step": 5,
      "default": 10
    },
    {
      "type": "header",
      "content": "Result States"
    },
    {
      "type": "range",
      "id": "result_border_radius",
      "label": "Result card border radius (px)",
      "min": 0,
      "max": 20,
      "step": 2,
      "default": 8
    },
    {
      "type": "color",
      "id": "success_background",
      "label": "Success background",
      "default": "#f0f9ff"
    },
    {
      "type": "color",
      "id": "success_border",
      "label": "Success border",
      "default": "#0ea5e9"
    },
    {
      "type": "color",
      "id": "success_text",
      "label": "Success text",
      "default": "#0c4a6e"
    },
    {
      "type": "color",
      "id": "warning_background",
      "label": "Warning background",
      "default": "#fefce8"
    },
    {
      "type": "color",
      "id": "warning_border",
      "label": "Warning border",
      "default": "#eab308"
    },
    {
      "type": "color",
      "id": "warning_text",
      "label": "Warning text",
      "default": "#a16207"
    },
    {
      "type": "color",
      "id": "error_background",
      "label": "Error background",
      "default": "#fef2f2"
    },
    {
      "type": "color",
      "id": "error_border",
      "label": "Error border",
      "default": "#ef4444"
    },
    {
      "type": "color",
      "id": "error_text",
      "label": "Error text",
      "default": "#dc2626"
    },
    {
      "type": "header",
      "content": "Recommended Products"
    },
    {
      "type": "checkbox",
      "id": "show_recommended_products",
      "label": "Show recommended products",
      "default": false
    },
    {
      "type": "text",
      "id": "recommended_title",
      "label": "Recommended products title",
      "default": "You might also like"
    },
    {
      "type": "range",
      "id": "recommended_title_size",
      "label": "Recommended title size (px)",
      "min": 16,
      "max": 32,
      "step": 2,
      "default": 20
    },
    {
      "type": "range",
      "id": "recommended_products_count",
      "label": "Number of products to show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "product_card_width",
      "label": "Product card minimum width (px)",
      "min": 120,
      "max": 200,
      "step": 10,
      "default": 150
    },
    {
      "type": "range",
      "id": "product_gap",
      "label": "Gap between products (px)",
      "min": 8,
      "max": 32,
      "step": 4,
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "Order Tracking Block",
      "settings": {
        "show_title": true,
        "title": "Track Your Order",
        "layout": "vertical",
        "text_alignment": "center",
        "primary_color": "#000000",
        "background_color": "#ffffff",
        "show_shadow": true
      }
    }
  ]
}
{% endschema %}